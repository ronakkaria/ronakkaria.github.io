"use strict";var app=angular.module("erpFrontendApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ui.router","ui.bootstrap","angular-toArrayFilter"]);app.config(["$stateProvider","$urlRouterProvider","$httpProvider",function(a,b,c){c.interceptors.push("AuthInterceptor"),a.state("main",{templateUrl:"views/skeleton.html"}).state("main.content",{views:{drawer:{templateUrl:"views/drawer.html",controller:"DrawerCtrl"},content:{templateUrl:"views/content.html"}}}).state("main.content.home",{url:"/home",templateUrl:"views/welcome.html",controller:"HomeCtrl",controllerAs:"home"}).state("main.content.about",{url:"/about",templateUrl:"views/about.html",controller:"AboutCtrl",controllerAs:"about"}).state("main.content.depot",{url:"/depot/:depotId",templateUrl:"views/depot.html",controller:"DepotCtrl"}).state("main.content.depot.tabs",{views:{active:{templateUrl:"views/active-depot-shipments.html",controller:"ActiveDepotShipmentsCtrl"},completed:{templateUrl:"views/completed-depot-shipments.html",controller:"CompletedDepotShipmentsCtrl"}}}).state("login",{url:"/login",templateUrl:"views/login.html",controller:"LoginCtrl"}).state("main.content.transport",{templateUrl:"views/transport.html",controller:"TransportCtrl"}).state("main.content.transport.tabs",{url:"/transport",views:{pending:{templateUrl:"views/pending-shipments.html",controller:"PendingShipmentsCtrl"},ongoing:{templateUrl:"views/ongoing-trips.html",controller:"OngoingTripsCtrl"},completed:{templateUrl:"views/completed-trips.html",controller:"CompletedTripsCtrl"}}}).state("signup",{url:"/signup",templateUrl:"views/signup.html",controller:"SignUpCtrl"})}]);var utils={};utils.getValueForKeyChain=function(a,b){if(!b)return void 0;var c=b.split(".");return a&&void 0!==a[c[0]]?1===c.length?a[c[0]]:a[c[0]]?utils.getValueForKeyChain(a[c[0]],c.splice(1,c.length).join(".")):void 0:void 0},utils.isSubsetArray=function(a,b){function c(a){var b=!1;return e.forEach(function(c){c===a&&(b=!0)}),b}var d,e;a.length<=b.length?(d=a,e=b):(d=b,e=a),d=d.map(function(a){return angular.toJson(a,0)}),e=e.map(function(a){return angular.toJson(a,0)});var f=!0;return d.forEach(function(a){c(a)||(f=!1)}),f},utils.emptyObject=function(a){for(var b in a)a.hasOwnProperty(b)&&delete a[b]},app.filter("isString",function(){return function(a){return"string"==typeof a}}),app.directive("tpLoginForm",function(){return{restrict:"E",scope:{action:"&action"},templateUrl:"views/directive-templates/login-form.html",link:function(a,b){b.bind("submit",function(){a.action()(a.username,a.password)})}}}),app.directive("tpNavigationDrawer",function(){return{restrict:"E",scope:{contents:"=contents",title:"@"},templateUrl:"views/directive-templates/navigation-drawer.html",link:function(){},controller:["$scope","$location",function(a,b){a.isActive=function(a){return b.path().substr(0,a.length)===a}}]}}),app.directive("tpSignupForm",function(){return{restrict:"E",scope:{action:"&",email:"=",mobile:"="},templateUrl:"views/directive-templates/signup-template.html",link:function(a,b){b.bind("submit",function(){a.action()(a.email,a.mobile,a.password)})}}}),app.directive("tpCollapse",["$animate","$injector",function(a,b){var c=b.has("$animateCss")?b.get("$animateCss"):null;return{link:function(b,d,e){function f(){d.removeClass("collapse").addClass("collapsing").attr("aria-expanded",!0).attr("aria-hidden",!1),c?c(d,{addClass:"in",easing:"ease",to:{height:d[0].scrollHeight+"px"}}).start()["finally"](g):a.addClass(d,"in",{to:{height:d[0].scrollHeight+"px"}}).then(g)}function g(){d.removeClass("collapsing").addClass("collapse").css({height:"auto"})}function h(){return d.hasClass("collapse")||d.hasClass("in")?(d.css({height:d[0].scrollHeight+"px"}).removeClass("collapse").addClass("collapsing").attr("aria-expanded",!1).attr("aria-hidden",!0),void(c?c(d,{removeClass:"in",to:{height:"0"}}).start()["finally"](i):a.removeClass(d,"in",{to:{height:"0"}}).then(i))):i()}function i(){d.css({height:"0"}),d.removeClass("collapsing").addClass("collapse")}function j(){d.addClass("in").height(d[0].scrollHeight).addClass("collapse").css({height:"auto"})}var k=!1;b.$watch(e.tpCollapse,function(a){a?h():k?f():j(),k=!0})}}}]),app.directive("tpShipmentGroup",function(){return{restrict:"E",require:"tpShipmentGroup",scope:{shipments:"=shipments",options:"=options",title:"@title",metadatas:"=metadatas",identifier:"@identifier",searchText:"@searchText"},transclude:{description:"tpShipmentGroupDescription"},templateUrl:"views/directive-templates/shipment/shipment-group.html",controller:["$scope","ShipmentDSFactory",function(a,b){this.removeShipment=function(b){a.options.remove.fn(b,a.identifier)},this.changeState=function(b,c){a.options.changeState.fn(b,c,a.identifier)},this.shipmentStateContextuals={PENDING:"danger",ASSIGNED:"warning",ARRIVED:"info",LOADED:"primary",COMPLETE:"success"},this.contextualClassToColorMap={danger:"red",warning:"yellow",info:"info",primary:"primary",success:"green"},this.getWeakestState=function(){var c=b.getStates(),d=1e3;return a.shipments.forEach(function(a){var b=c.indexOf(a.State);d>b&&(d=b)}),c[d]}}],controllerAs:"ShipmentGroupCtrl",link:function(a,b,c,d){function e(){if(a.options.contextualPanels){var b=d.getWeakestState(),c=d.shipmentStateContextuals[b];a.contextualColor=d.contextualClassToColorMap[c]}else a.contextualColor="default"}a.$watch("shipments",function(){e()})}}}),app.directive("tpShipmentTable",function(){return{restrict:"E",scope:!0,templateUrl:"views/directive-templates/shipment/shipment-table.html",link:function(){}}}),app.directive("tpShipmentRow",function(){return{restrict:"A",require:"^tpShipmentGroup",scope:{shipment:"=shipment",options:"=options",metadata:"=metadata"},templateUrl:"views/directive-templates/shipment/shipment-row.html",controller:["$scope",function(a){a.stopPropagation=function(a){a.stopPropagation()},a.setNewState=function(b){a.metadata.newState=b}}],link:function(a,b,c,d){a.remove=function(){d.removeShipment(a.shipment.id)},a.changeState=function(){d.changeState(a.shipment.id,a.newState)},a.shipmentStateContextuals=d.shipmentStateContextuals}}}),app.directive("tpShipmentTitles",function(){return{restrict:"A",scope:!0,templateUrl:"views/directive-templates/shipment/shipment-titles.html",link:function(){}}}),app.directive("tpShipmentExtras",function(){return{retstrict:"A",scope:{shipment:"=shipment",fields:"=fields",metadata:"=metadata"},templateUrl:"views/directive-templates/shipment/shipment-extras.html",link:function(){}}}),app.directive("tpKeyValueFilter",function(){return{restrict:"E",scope:{submitAction:"&submitAction",filterLabels:"=filterLabels"},templateUrl:"views/directive-templates/key-value-filter.html",link:function(a,b){b.bind("submit",function(){a.submitAction()(a.selectedFilterLabel,a.filterValue),a.showAppliedFilter=!0,a.appliedFilterLabel=a.selectedFilterLabel,a.appliedFilterValue=a.filterValue,a.selectedFilterLabel=void 0,a.filterValue=void 0}),a.removeFilters=function(){a.submitAction()(),a.showAppliedFilter=!1}}}}),app.directive("tpSearchBox",function(){return{restrict:"E",scope:{searchText:"=searchText"},templateUrl:"views/directive-templates/search-box.html",link:function(){}}}),app.factory("AuthTokenFactory",["$window",function(a){function b(){return e.getItem(f)}function c(a){a?e.setItem(f,a):g.clearToken()}function d(){e.removeItem(f)}var e=a.localStorage,f="auth-token",g={};return g.getToken=b,g.setToken=c,g.clearToken=d,g}]),app.factory("RoleToPathFactory",function(){return{"Depot Manager":function(a){return"/depot/"+a},"Transport Manager":function(){return"/transport"}}}),app.factory("AuthInterceptor",["AuthTokenFactory",function(a){function b(b){var c=a.getToken();return c&&(b.headers=b.headers||{},b.headers.Authorization="Bearer "+c),b}return{request:b}}]),app.factory("ShipmentDSFactory",function(){function a(){return g}function b(){return angular.copy(i)}function c(a){return h[a]}function d(a,b){if(!a||void 0===a.id)return void 0;var c={id:a.id};return b||(b=f.getAllFields()),b.forEach(function(b){var d=f.getKeyChain(b);c[b]=utils.getValueForKeyChain(a,d)}),c}function e(a,b){var c=[];return a.forEach(function(a){c.push(f.getFlat(a,b))}),c}var f={},g=["Id","Region","Depot","Customer Name","State","Cargo","Qty.","Trip Id"],h={Id:"id",Region:"customer.region",Depot:"depot","Customer Name":"customer.name",State:"state",Cargo:"cargo.name","Qty.":"cargo.quantity","Trip Id":"tripId"},i=["PENDING","ASSIGNED","ARRIVED","LOADED","COMPLETE"];return f.getAllFields=a,f.getKeyChain=c,f.getFlat=d,f.getFlats=e,f.getStates=b,f}),app.factory("TripDSFactory",["ShipmentDSFactory",function(a){function b(){return g}function c(a){return h[a]}function d(b,c){if(!b||void 0===b.id)return void 0;var d={id:b.id};return c||(c=f.getAllFields()),c.forEach(function(a){var c=f.getKeyChain(a);d[a]=utils.getValueForKeyChain(b,c)}),d.shipments=a.getFlats(b.shipments),d}function e(a,b){var c=[];return a.forEach(function(a){c.push(f.getFlat(a,b))}),c}var f={},g=["Id","Vendor","Vehicle Type"],h={Id:"id",Vendor:"vendor","Vehicle Type":"vehicleType"};return f.getAllFields=b,f.getKeyChain=c,f.getFlat=d,f.getFlats=e,f}]),app.factory("depotShipmentMock",["ShipmentServiceMockFactory",function(a){function b(b){var c=[];return c=a.pendingShipments().concat(a.ongoingShipments()),c.forEach(function(a){a.depot=b}),c}function c(b,c){var d=a.completedShipments();return d.forEach(function(a){a.depot=b}),console.log(c),d}function d(){return[{name:"Customer 1",region:"Region 1"},{name:"Customer 2",region:"Region 2"},{name:"Customer 3",region:"Region 3"}]}return{activeShipments:b,completedShipments:c,customers:d}}]),app.service("UserService",["AuthTokenFactory","$rootScope","$q",function(a,b,c){var d=this;this.signup=function(a,b,c){console.log(a+"\n"+b+"\n"+c),d.login()},this.login=function(){a.setToken("This is my brand new token"),b.$apply(function(){d.setUser({roles:{"Depot Manager":["id1","id2","id3"],"Transport Manager":[]}})})},this.logout=function(){a.clearToken(),d.setUser(void 0)},this.getUser=function(){return c.reject()},this.setUser=function(a){d.user=a,b.$broadcast("user.update")},this.user=void 0}]),app.service("ShipmentService",["$q","ShipmentServiceMockFactory","ShipmentDSFactory",function(a,b,c){var d=this;this.mock=b,this.DS=c,this.getPendingShipments=function(){return a.when(d.mock.pendingShipments())}}]),app.service("TransportService",["$q","TransportServiceMockFactory",function(a,b){this.mock=b,this.getVendors=function(){return Math.random()<.8?a.when(b.vendors()):a.reject()},this.getVehicleTypes=function(){return Math.random()<.8?a.when(b.vehicleTypes()):a.reject()}}]),app.service("TripService",["$q","TripServiceMockFactory","TripDSFactory",function(a,b,c){var d=this;this.mock=b,this.DS=c,this.getOngoingTrips=function(){return a.when(d.mock.ongoingTrips())},this.getCompletedTrips=function(){return a.when(d.mock.completedTrips())},this.getNumberOfCompletedTrips=function(){return a.when(88)},this.createTrip=function(){return Math.random()<.5?a.when():a.reject()},this.removeShipment=function(){return Math.random()<.5?a.when():a.reject()}}]),app.factory("ShipmentServiceMockFactory",function(){function a(){return[{id:"id0",depot:"Depot 5",customer:{name:"Customer 1",region:"Region 1"},cargo:{name:"Chocolates",quantity:24},state:"PENDING"},{id:"id1",depot:"Depot 6",customer:{name:"Customer 2",region:"Region 2"},cargo:{name:"Red Paint",quantity:47},state:"PENDING"},{id:"id2",depot:"Depot 6",customer:{name:"Customer 3",region:"Region 1"},cargo:{name:"Blue Paint",quantity:31},state:"PENDING"}]}function b(){return[{id:"id3",depot:"Depot 5",customer:{name:"Customer 1",region:"Region 1"},cargo:{name:"Candy Beans",quantity:33},state:"ASSIGNED",tripId:"tripId1"},{id:"id4",depot:"Depot 7",customer:{name:"Customer 2",region:"Region 4"},cargo:{name:"Plastic bottles",quantity:107},state:"LOADED",tripId:"tripId2"},{id:"id5",depot:"Depot 7",customer:{name:"Customer 3",region:"Region 8"},cargo:{name:"Shampoo",quantity:83},state:"ARRIVED",tripId:"tripId1"}]}function c(){return[{id:"id6",depot:"Depot 5",customer:{name:"Customer 1",region:"Region 1"},cargo:{name:"Lemon Snikets",quantity:82},state:"COMPLETE",tripId:"tripId1"},{id:"id7",depot:"Depot 7",customer:{name:"Customer 2",region:"Region 4"},cargo:{name:"Toothpicks",quantity:140},state:"COMPLETE",tripId:"tripId3"},{id:"id8",depot:"Depot 7",customer:{name:"Customer 3",region:"Region 8"},cargo:{name:"Cigarettes",quantity:79},state:"COMPLETE",tripId:"tripId3"}]}return{pendingShipments:a,ongoingShipments:b,completedShipments:c}}),app.factory("TransportServiceMockFactory",function(){function a(){return[{id:"id1",name:"TotoLogistics",contact:"123-678-3796"},{id:"id2",name:"SwamyTransport",contact:"457-321-8869"}]}function b(){return["TATA ACE","D52","Open Back"]}return{vendors:a,vehicleTypes:b}}),app.factory("TripServiceMockFactory",["ShipmentServiceMockFactory",function(a){function b(){return[{id:"tripId1",vendor:"TOTO Logistics",vehicleType:"TATA ACE",shipments:[a.ongoingShipments()[0],a.ongoingShipments()[2],a.completedShipments()[0]]},{id:"tripId2",vendor:"Swamy Transport Co.",vehicleType:"DCM",shipments:[a.ongoingShipments()[1]]}]}function c(){return[{id:"tripId3",vendor:"TOTO Logistics",vehicleType:"TATA ACE",shipments:[a.completedShipments()[0]]},{id:"tripId4",vendor:"Swamy Transport Co.",vehicleType:"DCM",shipments:[a.completedShipments()[1],a.completedShipments()[2]]}]}return{ongoingTrips:b,completedTrips:c}}]),app.service("DepotShipmentService",["$q","depotShipmentMock","$timeout","ShipmentDSFactory",function(a,b,c,d){var e=this;this.mock=b,this.DS=d,this.getActiveShipments=function(b){return a.when(e.mock.activeShipments(b))},this.getCompletedShipments=function(b,c){return console.log(c),a.when(e.mock.completedShipments(b,c))},this.getNumberOfCompletedShipments=function(){return a.when(83)},this.getCustomers=function(){return Math.random()<.8?a.when(e.mock.customers()):a.reject()},this.createShipment=function(b,d,e){console.log(b+d+e);var f=a.defer();return c(function(){Math.random()<.6?f.resolve():f.reject()},2e3),f.promise},this.changeShipmentState=function(){return a.when()}}]),app.controller("LoginCtrl",["$scope","UserService",function(a,b){a.login=function(a,c){b.login(a,c)}}]),angular.module("erpFrontendApp").controller("HomeCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),angular.module("erpFrontendApp").controller("AboutCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),app.controller("NavBarCtrl",["$scope","UserService",function(a,b){a.logout=function(){b.logout()}}]),app.controller("RootCtrl",["$scope","$location","UserService",function(a,b,c){function d(){var a=c.user;a?b.path("/home"):c.getUser().then(function(){})["catch"](function(){b.path("/login")})}d(),a.$on("user.update",function(){d()})}]),app.controller("DrawerCtrl",["$scope","RoleToPathFactory","UserService",function(a,b,c){function d(){if(c.user){var b=c.user.roles;for(var d in b)if(0===b[d].length)a.contents[d]=a.getPathForRole(d);else{var e=b[d];a.contents[d]={};for(var f in e){var g=e[f];a.contents[d][g]=a.getPathForRole(d,g)}}}}a.getPathForRole=function(a,c){return b[a](c)},a.contents={},d()}]),app.controller("TransportCtrl",["$scope","ShipmentService","TripService","$timeout",function(a,b,c,d){var e=this;a.pendingShipments=[],a.ongoingTrips=[],a.completedTrips=[],a.getPendingShipments=function(){b.getPendingShipments().then(function(b){a.pendingShipments=b})},a.getOngoingTrips=function(){c.getOngoingTrips().then(function(b){a.ongoingTrips=b})},a.getCompletedTrips=function(b,d,e){c.getCompletedTrips(b,d,e).then(function(b){a.completedTrips=b})},a.getNumberOfCompletedTrips=function(a){return c.getNumberOfCompletedTrips(a)},this.refresh=void 0,a.refreshData=function(){a.$broadcast("refresh-data"),d.cancel(e.refresh),e.refresh=d(function(){a.refreshData()},3e4)},a.$on("$destroy",function(){d.cancel(e.refresh)})}]),app.controller("SignUpCtrl",["$scope","UserService","$location",function(a,b,c){var d=c.search();a.email=d.email,a.mobile=Number(d.mobile),a.signup=function(a,d,e){b.signup(a,d,e),c.url(c.path())},console.log("signupController: "+a.email+", "+a.mobile)}]),app.controller("PendingShipmentsCtrl",["$scope","ShipmentService","$uibModal",function(a,b,c){var d=this;a.errors={},a.$on("refresh-data",function(){a.$parent.getPendingShipments()}),a.$watch("pendingShipments",function(){d.updateShipmentsMetaData(),d.groupShipments()}),a.$watch("groupBy",function(){d.setDisplayFields(),d.groupShipments()}),a.groups={},a.groupBy="Region",a.groupingFields=["Region","Depot","Customer Name"],this.groupShipments=function(){a.groups={},a.pendingShipments.forEach(function(c){var d=b.DS.getFlat(c),e=d[a.groupBy];a.groups[e]||(a.groups[e]=[]),a.groups[e].push(d)})},a.shipmentsMetaData={},this.updateShipmentsMetaData=function(){var b=[];a.pendingShipments.forEach(function(c){b.push(c.id),a.shipmentsMetaData[c.id]||(a.shipmentsMetaData[c.id]={selected:!1,expanded:!1})});for(var c in a.shipmentsMetaData)utils.isSubsetArray([c],b)||delete a.shipmentsMetaData[c]},this.allDisplayFields=["Depot","Customer Name","Region","Cargo","Qty."],this.extraFields=["Customer Name","Region","Cargo"],a.shipmentRowOptions={checkbox:!0,displayFields:[],extras:{fields:d.extraFields},contextualPanels:!0},this.setDisplayFields=function(){a.shipmentRowOptions.displayFields=[],d.allDisplayFields.forEach(function(b){a.groupBy!==b&&a.shipmentRowOptions.displayFields.push(b)})},this.getSelectedShipments=function(){var b=[];for(var c in a.shipmentsMetaData)a.shipmentsMetaData[c].selected===!0&&b.push(c);return b},a.errors.noShipmentsSelected=!1,this.modalOptions={templateUrl:"views/new-trip.html",controller:"NewTripCtrl"},a.createNewTrip=function(){var b=d.getSelectedShipments();if(a.errors.noShipmentsSelected=0===b.length,0!==b.length){var e=a.$new();e.selectedShipments=b;var f=angular.copy(d.modalOptions);f.scope=e;var g=c.open(f);g.result.then(function(){a.refreshData()})}}}]),app.controller("OngoingTripsCtrl",["$scope","TripService",function(a,b){var c=this;a.$on("refresh-data",function(){a.$parent.getOngoingTrips()}),a.$watch("ongoingTrips",function(){c.flattenTrips()}),this.displayFields=["Depot","Region","Customer Name","Cargo","Qty."],a.flatTrips=[],this.flattenTrips=function(){a.flatTrips=b.DS.getFlats(a.ongoingTrips)},this.removeShipment=function(c,d){b.removeShipment(c,d).then(function(){a.refreshData()})["catch"](function(){a.refreshData()})},a.shipmentRowOptions={contextualPanels:!0,displayFields:c.displayFields,displayState:!0,remove:{filter:function(a){return"ASSIGNED"===a.State},fn:c.removeShipment}}}]),app.controller("CompletedTripsCtrl",["$scope","TripService",function(a,b){var c=this;a.$on("refresh-data",function(){c.refreshPage()}),a.$watch("completedTrips",function(){c.flattenTrips()}),a.filterLabels=b.DS.getAllFields(),a.filter=void 0,a.curerntPage=1,a.updateFilterAndFetchTrips=function(b,d){a.filter=void 0,b&&d&&(a.filter={},a.filter[b]=d),a.currentPage=1,c.clearTripsData(),a.$parent.refreshData()},a.itemsPerPage=5,a.maxSize=6,a.totalItems=void 0,this.refreshPage=function(){function b(){a.$parent.getCompletedTrips(a.filter,a.itemsPerPage,a.currentPage)}a.$parent.getNumberOfCompletedTrips(a.filter).then(function(c){a.totalItems=c,b()})},this.clearTripsData=function(){a.flatTrips=[]},a.pageChanged=function(){c.clearTripsData(),a.$parent.refreshData()},this.displayFields=["Depot","Region","Customer Name","Cargo","Qty."],a.shipmentRowOptions={contextualPanels:!0,displayFields:c.displayFields,displayState:!0},this.flattenTrips=function(){a.flatTrips=b.DS.getFlats(a.completedTrips)}}]),app.controller("NewTripCtrl",["$scope","TransportService","$uibModal","TripService",function(a,b,c,d){var e=this;a.vendors=[],a.vehicleTypes=[],this.getVendors=function(){b.getVendors().then(function(b){a.vendors=b})["catch"](function(){e.openErrorModal({message:"Failed to load Vendors"},!0)})},this.getVehicleTypes=function(){b.getVehicleTypes().then(function(b){a.vehicleTypes=b})["catch"](function(){e.openErrorModal({message:"Failed to load Vehicle Types"},!0)})},e.getVendors(),e.getVehicleTypes(),a.selectedVendor={},a.selectedVehicleType=void 0,a.createTrip=function(){d.createTrip({vendor:a.selectedVendor,vehicleType:a.selectedVehicleType,shipmentIds:a.selectedShipments}).then(function(){a.$close()})["catch"](function(){e.openErrorModal({message:"Failed to create trip. Please try again"},!1)})},this.errorModalOpen=!1,this.openErrorModal=function(b,d){if(e.errorModalOpen!==!0){e.errorModalOpen=!0;var f=a.$new();f.error=b;var g=c.open({templateUrl:"views/error.html",scope:f});g.result.then(function(){d?a.$dismiss():e.errorModalOpen=!1})["catch"](function(){d?a.$dismiss():e.errorModalOpen=!1})}}}]),app.controller("DepotCtrl",["$scope","$timeout","$stateParams","$state","DepotShipmentService",function(a,b,c,d,e){var f=this;d.go(".tabs"),a.depotId=c.depotId,a.activeShipments=[],a.completedShipments=[],a.getActiveShipments=function(){e.getActiveShipments(a.depotId).then(function(b){a.activeShipments=b})},a.getCompletedShipments=function(b,c,d){e.getCompletedShipments(a.depotId,b,c,d).then(function(b){a.completedShipments=b})},a.getNumberOfCompletedShipments=function(b){return e.getNumberOfCompletedShipments(a.depotId,b)},this.refresh=void 0,a.refreshData=function(){a.$broadcast("refresh-data"),b.cancel(f.refresh),f.refresh=b(function(){a.refreshData()},3e4)},a.$on("$destroy",function(){b.cancel(f.refresh)})}]),app.controller("ActiveDepotShipmentsCtrl",["$scope","$uibModal","DepotShipmentService",function(a,b,c){var d=this;a.$on("refresh-data",function(){a.$parent.getActiveShipments()}),a.refreshData(),a.$watch("activeShipments",function(){d.flattenShipments(),d.updateShipmentsMetaData()}),this.allDisplayFields=["Customer Name","Region","Cargo","Qty.","Trip Id"],this.changeShipmentState=function(b,d){c.changeShipmentState(a.$parent.depotId,b,d).then(function(){a.$parent.refreshData()})},a.shipmentOptions={displayFields:d.allDisplayFields,displayState:!0,changeState:{fn:d.changeShipmentState,states:c.DS.getStates().slice(1),filter:function(a){return"PENDING"!==a.State}}},a.flatShipments=[],this.flattenShipments=function(){a.flatShipments=c.DS.getFlats(a.activeShipments)},a.shipmentsMetaData={},this.updateShipmentsMetaData=function(){var b=c.DS.getStates().slice(1),d={};a.activeShipments.forEach(function(c){if(!a.shipmentsMetaData[c.id]){var e=c.state,f=b.indexOf(e);a.shipmentsMetaData[c.id]={newState:b[f+1]}}d[c.id]=c});for(var e in a.shipmentsMetaData)d[e]||delete a.shipmentsMetaData[e];for(e in a.shipmentsMetaData){var f=d[e].state,g=a.shipmentsMetaData[e].newState;if(g===f){var h=b.indexOf(f);a.shipmentsMetaData[e].newState=b[h+1]}}},this.modalOptions={templateUrl:"views/new-shipment.html",controller:"NewShipmentCtrl",backdrop:"static"},a.addShipment=function(){var c=a.$new(),e=angular.copy(d.modalOptions);e.scope=c;var f=b.open(e);f.result.then(function(){a.refreshData()})}}]),app.controller("CompletedDepotShipmentsCtrl",["$scope","DepotShipmentService",function(a,b){var c=this;a.$on("refresh-data",function(){c.refreshPage()}),a.flatShipments=[],a.$watch("completedShipments",function(){c.flattenShipments()}),a.filterLabels=b.DS.getAllFields(),a.filter=void 0,a.currentPage=1,a.updateFilterAndFetchShipments=function(b,d){a.filter=void 0,b&&d&&(a.filter={},a.filter[b]=d),a.currentPage=1,c.clearShipmentsData(),a.$parent.refreshData()},a.itemsPerPage=5,a.maxSize=6,a.totalItems=void 0,a.pageChanged=function(){c.clearShipmentsData(),a.refreshData()},this.clearShipmentsData=function(){a.flatShipments=[]},this.refreshPage=function(){function b(){a.$parent.getCompletedShipments(a.filter,a.itemsPerPage,a.currentPage)}a.$parent.getNumberOfCompletedShipments(a.filter).then(function(c){a.totalItems=c,b()})},this.flattenShipments=function(){a.flatShipments=b.DS.getFlats(a.$parent.completedShipments)},this.allDisplayFields=["Customer Name","Region","Cargo","Qty.","Trip Id"],a.shipmentOptions={displayFields:c.allDisplayFields,displayState:!0}}]),app.controller("NewShipmentCtrl",["$scope","DepotShipmentService","$uibModal",function(a,b,c){var d=this;a.customers=[],a.cargo={},a.getCustomers=function(){b.getCustomers().then(function(b){a.customers=b})["catch"](function(){d.openErrorModal({message:"Failed to load Customers"},!0)})},a.getCustomers(),a.createShipment=function(){a.bApiCallOnProgress=!0,b.createShipment(a.depotId,a.selectedCustomer,a.cargo).then(function(){a.bApiCallOnProgress=!1,a.$close()})["catch"](function(){a.bApiCallOnProgress=!1,d.openErrorModal({message:"Failed to create Shipment. Please try again"},!1)})},this.errorModalOpen=!1,this.openErrorModal=function(b,e){if(d.errorModalOpen!==!0){d.errorModalOpen=!0;var f=a.$new();f.error=b;var g=c.open({templateUrl:"views/error.html",scope:f});g.result.then(function(){e?a.$dismiss():d.errorModalOpen=!1})["catch"](function(){e?a.$dismiss():d.errorModalOpen=!1})}}}]),angular.module("erpFrontendApp").run(["$templateCache",function(a){a.put("views/about.html","<p>This is the about view.</p>"),a.put("views/active-depot-shipments.html",'<tp-search-box search-text="searchText"></tp-search-box> <button class="btn btn-primary" ng-click="addShipment()">Add Shipment</button> <div class="row"> <tp-shipment-group class="col-sm-12" options="shipmentOptions" shipments="flatShipments" metadatas="shipmentsMetaData" search-text="{{searchText}}"> </tp-shipment-group> </div>'),a.put("views/completed-depot-shipments.html",'<tp-key-value-filter submit-action="updateFilterAndFetchShipments" filter-labels="filterLabels"> </tp-key-value-filter> <div class="row"> <tp-shipment-group class="col-sm-12" options="shipmentOptions" shipments="flatShipments"> </tp-shipment-group> </div> <uib-pagination total-items="totalItems" ng-model="currentPage" ng-change="pageChanged()" max-size="maxSize" items-per-page="itemsPerPage" class="pagination-sm" boundary-links="true" rotate="false" previous-text="&lsaquo;" next-text="&rsaquo;" first-text="&laquo;" last-text="&raquo;"></uib-pagination>'),a.put("views/completed-trips.html",'<tp-key-value-filter submit-action="updateFilterAndFetchTrips" filter-labels="filterLabels"> </tp-key-value-filter> <div class="row"> <div ng-repeat="trip in flatTrips" class="col-sm-12"> <tp-shipment-group title="{{trip.id}}" options="shipmentRowOptions" shipments="trip.shipments"> <tp-shipment-group-description> <div class="container-fluid"> <div><strong>Vendor: </strong>{{trip["Vendor"]}}</div> <div><strong>Vehicle Type: </strong>{{trip["Vehicle Type"]}}</div> </div> </tp-shipment-group-description> </tp-shipment-group> </div> </div> <uib-pagination total-items="totalItems" ng-model="currentPage" ng-change="pageChanged()" max-size="maxSize" items-per-page="itemsPerPage" class="pagination-sm" boundary-links="true" rotate="false" previous-text="&lsaquo;" next-text="&rsaquo;" first-text="&laquo;" last-text="&raquo;"></uib-pagination>'),a.put("views/content.html","<div ui-view></div>"),a.put("views/depot.html",'<uib-tabset justified="true"> <uib-tab heading="Active Shipments" select="refreshData()"> <div ui-view="active"></div> </uib-tab> <uib-tab heading="Completed Shipments" select="refreshData()"> <div ui-view="completed"></div> </uib-tab> </uib-tabset>'),a.put("views/directive-templates/key-value-filter.html",'<form class="form-inline"> <div class="form-group"> <select ng-options="label for label in filterLabels" ng-model="selectedFilterLabel" required> <option value="">-- Choose Filter --</option> </select> </div> <div class="form-group"> <input type="text" ng-model="filterValue" placeholder="Search.." required>  </div> <button type="submit" class="btn btn-primary"> Filter </button> </form> <div ng-if="showAppliedFilter"> <span><strong>{{appliedFilterLabel}}: </strong></span> <span><strong>{{appliedFilterValue}}</strong></span> <span> <button ng-click="removeFilters()"> <i class="fa fa-times"></i> </button> </span> </div>'),a.put("views/directive-templates/login-form.html",'<div class="jumbotron"> <form ng-submit> <div> Username: <input type="text" ng-model="username" required> </div> <br> <div> Password: <input type="password" ng-model="password" required> </div> <br> <div> <button type="submit">Submit</button> </div> </form> </div>'),a.put("views/directive-templates/navigation-drawer.html",'<div class="sidebar-nav"> <ul class="nav"> <div ng-repeat="(item, val) in contents"> <li ng-if="val | isString"> <a ng-href="{{&quot;#&quot;+val}}" ng-class="{active:isActive(val)}"> {{item}} </a> </li> <div ng-if="!(val | isString)"> <li ng-click="isCollapsed = !isCollapsed" ng-class="{active:!isCollapsed}"> <a ng-href="">{{item}} <span class="fa arrow"></span></a> </li> <ul uib-collapse="isCollapsed" class="nav nav-second-level"> <div ng-repeat="(subItem, path) in val"> <li> <a ng-href="{{&quot;#&quot;+path}}" ng-class="{active:isActive(path)}"> {{subItem}} </a> </li> </div> </ul> </div> </div> </ul> </div>'),a.put("views/directive-templates/search-box.html",'<div class="container-fluid"> <div class="row"> <div class="col-sm-3 form-group input-group"> <span class="input-group-addon"> <i class="fa fa-search"></i> </span> <input class="form-control" ng-model="searchText" placeholder="Search.."> </div> </div> </div>'),a.put("views/directive-templates/signup-template.html",'<div> <form class="form-horizontal" name="signupForm" novalidate> <!--<div class="form-group">\n            <label for="email">Email</label>\n            <input type="email" name="email" id="email" ng-model="email" class="form-control" required />\n            <span style="color:red" ng-show="signupForm.email.$dirty && signupForm.email.$invalid">\n                <span ng-show="signupForm.email.$error.required">Email is required.</span>\n                <span ng-show="signupForm.email.$error.email">Invalid email address.</span>\n            </span>\n        </div>\n\n        <div class="form-group">\n            <label for="mobile">Mobile</label>\n            <input type="number" name="mobile" ng-model="mobile" class="form-control" required />\n            <span style="color:red" ng-show="signupForm.mobile.$dirty && signupForm.mobile.$invalid">\n                <span ng-show="signupForm.mobile.$error.required">Mobile is required.</span>\n            </span>\n        </div>--> <div class="form-group"> <label for="email" class="col-sm-3 control-label">Email</label> <div class="col-sm-9"> <input type="email" name="email" id="email" ng-model="email" class="form-control" readonly> </div> </div> <div class="form-group"> <label for="mobile" class="col-sm-3 control-label">Mobile</label> <div class="col-sm-9"> <input type="number" name="mobile" ng-model="mobile" class="form-control" readonly> </div> </div> <div class="form-group"> <label for="password" class="col-sm-3 control-label">Password</label> <div class="col-sm-9"> <input type="password" name="password" ng-model="password" class="form-control" required> <span style="color:red" ng-show="signupForm.password.$dirty && signupForm.password.$invalid"> <span ng-if="signupForm.password.$error.required">Password is required.</span> </span> </div> </div> <div class="form-group"> <label for="password1" class="col-sm-3 control-label">Retype Password</label> <div class="col-sm-9"> <input type="password" name="password1" ng-model="password1" class="form-control" required> <span style="color:red" ng-show="signupForm.password1.$dirty && signupForm.password1.$invalid"> <span ng-if="signupForm.password1.$error.required">Password is required.</span> </span> <span style="color:red" ng-show="signupForm.password1.$dirty && signupForm.password1.$valid"> <span ng-if="password1!==password">Passwords do not match yet.</span> </span> </div> </div> <div class="form-group"> <div class="col-sm-offset-3 col-sm-9"> <button type="submit" class="btn btn-primary" ng-disabled="signupForm.password.$dirty && signupForm.password.$invalid || signupForm.password1.$dirty && signupForm.password1.$invalid || password1!==password || signupForm.password.$pristine"> Sign Up </button> </div> </div> </form> </div>'),
a.put("views/drawer.html",'<tp-navigation-drawer contents="contents" title="Roles"></tp-navigation-drawer>'),a.put("views/error.html",'<div class="modal-header"> <h3 class="modal-title">Error!</h3> </div> <div class="modal-body"> <p class="alert alert-danger">{{error.message}}</p> </div> <div class="modal-footer"> <button class="btn btn-warning" ng-click="$close()">Ok</button> </div>'),a.put("views/home.html",'<div class="jumbotron"> <h1>\'Allo, \'Allo!</h1> <p class="lead"> <img src="images/yeoman.17a02656.png" alt="I\'m Yeoman"><br> Always a pleasure scaffolding your apps. </p> <p><a class="btn btn-lg btn-success" ng-href="#/">Splendid!<span class="glyphicon glyphicon-ok"></span></a></p> </div> <div class="row marketing"> <h4>HTML5 Boilerplate</h4> <p> HTML5 Boilerplate is a professional front-end template for building fast, robust, and adaptable web apps or sites. </p> <h4>Angular</h4> <p> AngularJS is a toolset for building the framework most suited to your application development. </p> <h4>Karma</h4> <p>Spectacular Test Runner for JavaScript.</p> </div>'),a.put("views/login.html",'<tp-login-form action="login"> </tp-login-form>'),a.put("views/navbar.html",'<div class="header"> <div class="navbar navbar-default" role="navigation"> <div class="container"> <div class="navbar-header"> <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#js-navbar-collapse"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" href="#/">erpFrontend</a> </div> <div class="collapse navbar-collapse" id="js-navbar-collapse"> <ul class="nav navbar-nav"> <li class="active"><a href="#/">Home</a></li> <li><a ng-href="#/about">About</a></li> <li><a ng-href="#/">Contact</a></li> </ul> <div class="pull-right"> <button class="alert alert-danger" ng-click="logout()">Logout</button> </div> </div> </div> </div> </div>'),a.put("views/new-shipment.html",'<div class="modal-header"> <h3 class="modal-title">New Shipment</h3> </div> <form class="form-horizontal" ng-submit="createShipment()"> <div class="modal-body"> <div class="form-group"> <label>Customer</label> <select ng-options="customer.name for customer in customers" ng-model="selectedCustomer" class="form-control" required></select> </div> <div class="form-group"> <label>Cargo Name</label> <input type="text" class="form-control" ng-model="cargo.name" required> </div> <div class="form-group"> <label>Cargo Quantity</label> <input type="number" class="form-control" ng-model="cargo.quantity" required> </div> </div> <div class="modal-footer"> <i ng-if="bApiCallOnProgress" class="fa fa-spinner fa-spin fa-2x"></i> <button type="submit" class="btn btn-primary" ng-disabled="bApiCallOnProgress">Create Shipment</button> <button type="button" class="btn" ng-click="$dismiss()" ng-disabled="bApiCallOnProgress">Cancel</button> </div> </form>'),a.put("views/new-trip.html",'<div class="modal-header"> <h3 class="modal-title">New Trip</h3> </div> <form ng-submit="createTrip()"> <div class="modal-body"> <label>Vendor <select ng-options="vendor.name for vendor in vendors" ng-model="selectedVendor" required> <option value="">-- Choose Vendor --</option> </select> </label> <label>Vehicle Type <select ng-options="vehicleType for vehicleType in vehicleTypes" ng-model="selectedVehicleType" required> <option value="">-- Choose Vehicle Type --</option> </select> </label> </div> <div class="modal-footer"> <button type="submit" class="btn btn-primary">Create</button> <button type="button" class="btn" ng-click="$dismiss()">Cancel</button> </div> </form>'),a.put("views/ongoing-trips.html",'<tp-search-box search-text="searchText"></tp-search-box> <div class="row"> <div ng-repeat="trip in flatTrips | filter: searchText" class="col-sm-12"> <tp-shipment-group options="shipmentRowOptions" shipments="trip.shipments" title="{{trip.id}}" search-text="{{searchText}}"> <tp-shipment-group-description> <div class="container-fluid"> <div><strong>Vendor: </strong>{{trip["Vendor"]}}</div> <div><strong>Vehicle Type: </strong>{{trip["Vehicle Type"]}}</div> </div> </tp-shipment-group-description> </tp-shipment-group> </div> </div>'),a.put("views/pending-shipments.html",'<tp-search-box search-text="searchText"></tp-search-box> <div> <button class="btn btn-primary" ng-click="createNewTrip()">Create Trip</button> </div> <div ng-if="errors.noShipmentsSelected" class="alert alert-danger"> No Shipments Selected </div> <div> <br> <span><strong>Group by:</strong></span> <span> <select ng-options="field for field in groupingFields" ng-model="groupBy"></select> </span> <br> </div> <div class="row"> <div ng-repeat="groupList in groups | toArray:true | filter: searchText" class="col-md-6"> <tp-shipment-group options="shipmentRowOptions" metadatas="shipmentsMetaData" shipments="groupList" title="{{groupList.$key}}" search-text="{{searchText}}"> </tp-shipment-group> </div> </div>'),a.put("views/signup.html",'<tp-signup-form action="signup" email="email" mobile="mobile"> </tp-signup-form>'),a.put("views/skeleton.html",'<nav class="navbar navbar-default navbar-static-top" style="margin-bottom: 0"> <div ui-view="drawer" class="navbar-default sidebar"></div> </nav> <div ui-view="content" id="page-wrapper"></div>'),a.put("views/transport.html",'<uib-tabset justified="true"> <uib-tab heading="Pending Shipments" select="refreshData()"> <div ui-view="pending"></div> </uib-tab> <uib-tab heading="Ongoing Trips" select="refreshData()"> <div ui-view="ongoing"></div> </uib-tab> <uib-tab heading="Completed Trips" select="refreshData()"> <div ui-view="completed"></div> </uib-tab> </uib-tabset>'),a.put("views/welcome.html",'<div class="well"> <h2>Welcome!</h2> </div>')}]);